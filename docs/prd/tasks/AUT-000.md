# AUT-000: Domain Skeleton + Infrastructure ì„¤ì •

**Epic**: IAM Platform (AuthHub)
**Feature**: ê³µí†µ ê¸°ë°˜ (Foundation)
**Phase**: Phase 0
**ë¸Œëœì¹˜**: feature/AUT-000-foundation
**Jira URL**: https://ryuqqq.atlassian.net/browse/AUT-53
**ìƒíƒœ**: In Progress
**ì‹œì‘ì¼**: 2025-11-24
**ë‹´ë‹¹ì**: ë¥˜ìƒì›
**ì˜ì¡´ì„±**: ì—†ìŒ (ìµœì´ˆ Task)

---

## ğŸ“ ëª©ì 

ëª¨ë“  ê¸°ëŠ¥ì˜ ê³µí†µ ê¸°ë°˜ ë§ˆë ¨
- í•µì‹¬ Domain Aggregate ê¸°ë³¸ êµ¬ì¡° (ìµœì†Œ ì†ì„±ë§Œ)
- Infrastructure ì„¤ì • (Flyway, HikariCP, Redis)
- Multi-module í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¸íŒ…

---

## ğŸ¯ ìš”êµ¬ì‚¬í•­

### 1. Domain Layer

#### 1.1 User Aggregate (ìµœì†Œ êµ¬ì¡°)
- [ ] **User Aggregate Root** ê¸°ë³¸ êµ¬ì¡°
  - userId (UserId VO, UUID)
  - tenantId (Long FK)
  - organizationId (Long FK, Nullable)
  - userType (Enum: PUBLIC, INTERNAL)
  - status (UserStatus Enum: ACTIVE, INACTIVE, SUSPENDED, DELETED)
  - createdAt, updatedAt (LocalDateTime)

- [ ] **UserId VO** (UUID ê¸°ë°˜)
- [ ] **UserType Enum** (PUBLIC, INTERNAL)
- [ ] **UserStatus Enum** (ACTIVE, INACTIVE, SUSPENDED, DELETED)

#### 1.2 Tenant Aggregate (ìµœì†Œ êµ¬ì¡°)
- [ ] **Tenant Aggregate Root** ê¸°ë³¸ êµ¬ì¡°
  - tenantId (TenantId VO, Long)
  - name (TenantName VO)
  - status (TenantStatus Enum: ACTIVE, INACTIVE, DELETED)
  - createdAt, updatedAt

- [ ] **TenantId VO** (Long ê¸°ë°˜)
- [ ] **TenantName VO** (String, ê²€ì¦ ë¡œì§)
- [ ] **TenantStatus Enum**

#### 1.3 Organization Aggregate (ìµœì†Œ êµ¬ì¡°)
- [ ] **Organization Aggregate Root** ê¸°ë³¸ êµ¬ì¡°
  - organizationId (OrganizationId VO, Long)
  - tenantId (Long FK)
  - name (OrganizationName VO)
  - status (OrganizationStatus Enum: ACTIVE, INACTIVE, DELETED)
  - createdAt, updatedAt

- [ ] **OrganizationId VO** (Long ê¸°ë°˜)
- [ ] **OrganizationName VO** (2-100ì, ê²€ì¦ ë¡œì§)
- [ ] **OrganizationStatus Enum**

### 2. Application Layer

**ì´ ë‹¨ê³„ì—ì„œëŠ” UseCase êµ¬í˜„í•˜ì§€ ì•ŠìŒ** (ê¸°ë³¸ Portë§Œ ì •ì˜)

- [ ] **Port ì¸í„°í˜ì´ìŠ¤ íŒ¨í‚¤ì§€ êµ¬ì¡°**
  - `port.in.command` (Command UseCase ì¸í„°í˜ì´ìŠ¤)
  - `port.in.query` (Query UseCase ì¸í„°í˜ì´ìŠ¤)
  - `port.out.command` (Command Port ì¸í„°í˜ì´ìŠ¤)
  - `port.out.query` (Query Port ì¸í„°í˜ì´ìŠ¤)

### 3. Persistence Layer

#### 3.1 JPA Entity (ê¸°ë³¸ êµ¬ì¡°ë§Œ)
- [ ] **UserEntity**
  - id, tenant_id, organization_id, user_type, status
  - created_at, updated_at
  - BaseAuditEntity ìƒì†

- [ ] **TenantEntity**
  - id, name, status, created_at, updated_at

- [ ] **OrganizationEntity**
  - id, tenant_id, name, status, created_at, updated_at

- [ ] **BaseAuditEntity** (ê³µí†µ ê°ì‚¬ í•„ë“œ)
  - createdAt, updatedAt
  - @EntityListeners(AuditingEntityListener.class)

#### 3.2 Flyway ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] **V1__init_schema.sql**
  - tenants í…Œì´ë¸” ìƒì„±
  - organizations í…Œì´ë¸” ìƒì„±
  - users í…Œì´ë¸” ìƒì„± (ê¸°ë³¸ ì»¬ëŸ¼ë§Œ)
  - Index ë° Unique Constraint

- [ ] **V2__insert_default_data.sql**
  - "Connectly Public Tenant" ì‚½ì…
  - ì‹œìŠ¤í…œ ê¸°ë³¸ Organization (ì„ íƒ)

#### 3.3 HikariCP ì„¤ì •
- [ ] **application.yml** (datasource ì„¤ì •)
  - maximumPoolSize: 10
  - minimumIdle: 5
  - connectionTimeout: 30000
  - idleTimeout: 600000
  - maxLifetime: 1800000

#### 3.4 Redis ì„¤ì •
- [ ] **RedisConfig.java**
  - RedisConnectionFactory Bean
  - RedisTemplate Bean
  - StringRedisTemplate Bean

- [ ] **application.yml** (redis ì„¤ì •)
  - host: localhost
  - port: 6379
  - timeout: 3000ms

### 4. REST API Layer

**ì´ ë‹¨ê³„ì—ì„œëŠ” Controller êµ¬í˜„í•˜ì§€ ì•ŠìŒ** (ê³µí†µ DTOë§Œ ì •ì˜)

- [ ] **ApiResponse<T>** (ê³µí†µ ì‘ë‹µ DTO)
  - success (Boolean)
  - data (T)
  - timestamp (LocalDateTime)

- [ ] **PageApiResponse<T>** (í˜ì´ì§• ì‘ë‹µ DTO)
  - content (List<T>)
  - totalElements (Long)
  - totalPages (int)
  - currentPage (int)

- [ ] **ErrorInfo** (ê³µí†µ ì—ëŸ¬ DTO)
  - errorCode (String)
  - message (String)
  - details (Map<String, Object>)

- [ ] **GlobalExceptionHandler** (ê¸°ë³¸ êµ¬ì¡°ë§Œ)

### 5. Integration Test

- [ ] **TestConfiguration**
  - ClockConfig (ê³ ì •ëœ ì‹œê°)
  - EmbeddedRedis ì„¤ì • (í…ŒìŠ¤íŠ¸ìš©)

- [ ] **Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸**
  - V1, V2 ìˆœì°¨ ì‹¤í–‰ ê²€ì¦
  - ìŠ¤í‚¤ë§ˆ ìƒì„± í™•ì¸
  - ê¸°ë³¸ ë°ì´í„° ì‚½ì… í™•ì¸

---

## âš ï¸ ì œì•½ì‚¬í•­

### Zero-Tolerance ê·œì¹™
- [ ] **Lombok ê¸ˆì§€** - Pure Java ë˜ëŠ” Record ì‚¬ìš©
- [ ] **Long FK ì „ëµ** - JPA ê´€ê³„ ì–´ë…¸í…Œì´ì…˜ ê¸ˆì§€
  - `private Long tenantId` âœ…
  - `@ManyToOne private Tenant tenant` âŒ

### ìµœì†Œ êµ¬í˜„ ì›ì¹™
- [ ] **YAGNI ì¤€ìˆ˜** - ì´ ë‹¨ê³„ì—ì„œëŠ” ìµœì†Œ ì†ì„±ë§Œ êµ¬í˜„
- [ ] **í™•ì¥ ê°€ëŠ¥ êµ¬ì¡°** - í–¥í›„ ê¸°ëŠ¥ì—ì„œ ì†ì„± ì¶”ê°€ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„

### í…ŒìŠ¤íŠ¸ ê·œì¹™
- [ ] **ArchUnit í…ŒìŠ¤íŠ¸** í•„ìˆ˜
  - Lombok ì‚¬ìš© ê¸ˆì§€ ê²€ì¦
  - Long FK ì „ëµ ê²€ì¦
  - ë ˆì´ì–´ ì˜ì¡´ì„± ê²€ì¦
- [ ] **Flyway ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸**
- [ ] **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€** > 80%

---

## âœ… ì™„ë£Œ ì¡°ê±´

- [ ] Domain Layer ê¸°ë³¸ êµ¬ì¡° ì™„ë£Œ (User, Tenant, Organization)
- [ ] Persistence Layer ê¸°ë³¸ êµ¬ì¡° ì™„ë£Œ (Entity, Flyway)
- [ ] Infrastructure ì„¤ì • ì™„ë£Œ (HikariCP, Redis)
- [ ] ê³µí†µ DTO êµ¬ì¡° ì™„ë£Œ
- [ ] ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ (Unit + ArchUnit + Flyway)
- [ ] Zero-Tolerance ê·œì¹™ ì¤€ìˆ˜
- [ ] ì½”ë“œ ë¦¬ë·° ìŠ¹ì¸
- [ ] PR ë¨¸ì§€ ì™„ë£Œ

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- **PRD**: docs/prd/iam-platform.md
- **Plan**: docs/prd/plans/AUT-000-foundation-plan.md (create-plan í›„ ìƒì„±)
- **Jira**: https://ryuqqq.atlassian.net/browse/AUT-53

---

## ğŸ“Œ ì°¸ê³  ì‚¬í•­

ì´ TaskëŠ” **ëª¨ë“  ê¸°ëŠ¥ì˜ ê³µí†µ ê¸°ë°˜**ì…ë‹ˆë‹¤.
- ìµœì†Œí•œì˜ Domain êµ¬ì¡°ë§Œ ì œê³µ
- ê° ê¸°ëŠ¥(AUT-001~)ì—ì„œ í•„ìš”í•œ ì†ì„±/ë©”ì„œë“œ ì¶”ê°€
- InfrastructureëŠ” í•œ ë²ˆë§Œ ì„¤ì •
