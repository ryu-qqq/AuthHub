# AUT-013: User-Role í• ë‹¹

**Epic**: IAM Platform (AuthHub)
**Feature**: User-Role í• ë‹¹
**Phase**: Phase 2 - Organization & Authorization
**ë¸Œëœì¹˜**: feature/AUT-013-user-role-assignment
**ì˜ì¡´ì„±**: AUT-000, AUT-009 (Role ì‹œìŠ¤í…œ), AUT-010 (Permission ê´€ë¦¬)

---

## ğŸ“ ëª©ì 

ì‚¬ìš©ìì—ê²Œ Role í• ë‹¹ ë° ê¶Œí•œ ê²€ì¦ ê¸°ëŠ¥ êµ¬í˜„
- Userì—ê²Œ Role í• ë‹¹ (SUPER_ADMIN, ORG_ADMIN ì „ìš©)
- Userë¡œë¶€í„° Role ì œê±°
- Userì˜ Role ëª©ë¡ ì¡°íšŒ
- Userì˜ Permission ì¡°íšŒ (Role â†’ Permission ì—°ê²°)
- ê¶Œí•œ ê²€ì¦ (hasPermission)

---

## ğŸ¯ ìš”êµ¬ì‚¬í•­

### 1. Domain Layer

#### 1.1 User Aggregate í™•ì¥
- [ ] **User Aggregateì— ì¶”ê°€**:
  - roles (Set<RoleId>)
  - `assignRole(RoleId, Long assignedBy, ClockHolder)` â†’ void
  - `removeRole(RoleId)` â†’ void
  - `hasRole(RoleId)` â†’ boolean

**ì¤‘ìš”**: `hasPermission()` ë©”ì„œë“œëŠ” **Application Layerì˜ PermissionResolverServiceë¡œ ì´ë™**
- User AggregateëŠ” "ì–´ë–¤ Roleì„ ê°€ì¡ŒëŠ”ì§€"ë§Œ ì•Œê³  ìˆìŒ
- "ê·¸ Roleì´ ì–´ë–¤ Permissionì„ ê°€ì¡ŒëŠ”ì§€"ëŠ” Application Layerì—ì„œ ì²˜ë¦¬
- ì´ìœ : N+1 ë¬¸ì œ ë°©ì§€, CQRS Query Model í™œìš©, ìºì‹± ê°€ëŠ¥

#### 1.2 UserRole VO
- [ ] **UserRole VO** ìƒì„±
  - userId (Long)
  - roleId (Long)
  - assignedAt (LocalDateTime)
  - assignedBy (Long)

#### 1.3 Role Aggregate í™•ì¥
- [ ] **Role Aggregateì— ì¶”ê°€**:
  - **Roleì€ Permission ID ëª©ë¡ì„ ì €ì¥í•˜ì§€ ì•ŠìŒ**
  - RolePermissionì€ ë³„ë„ì˜ Join Tableë¡œ Persistence Layerì—ì„œë§Œ ê´€ë¦¬
  - Domain Layerì—ì„œëŠ” Roleê³¼ Permissionì˜ ì§ì ‘ì ì¸ ì—°ê²° ì—†ìŒ

**ì¤‘ìš”**: Role â†’ Permission ì—°ê²°ì€ **Application Layerì˜ PermissionResolverServiceì—ì„œ ì²˜ë¦¬**

#### 1.4 RolePermission VO
- [ ] **RolePermission VO** ìƒì„±
  - roleId (Long)
  - permissionId (Long)
  - assignedAt (LocalDateTime)

#### 1.5 Domain Exception
- [ ] **UserAlreadyHasRoleException** (ì´ë¯¸ Role ë³´ìœ )
- [ ] **UserDoesNotHaveRoleException** (Role ë¯¸ë³´ìœ )
- [ ] **InsufficientPermissionException** (ê¶Œí•œ ë¶€ì¡±)

#### 1.6 Domain Event
- [ ] **RoleAssignedToUser** Event
  - userId, roleId, assignedBy, assignedAt

- [ ] **RoleRemovedFromUser** Event
  - userId, roleId, removedBy, removedAt

- [ ] **PermissionAssignedToRole** Event
  - roleId, permissionId, assignedBy, assignedAt

### 2. Application Layer

#### 2.0 PermissionResolverService (í•µì‹¬ ì„œë¹„ìŠ¤)
- [ ] **PermissionResolverService** ìƒì„±
  - `hasPermission(Long userId, ResourceType resource, ActionType action)` â†’ boolean
  - `getUserPermissions(Long userId)` â†’ Set<Permission>
  - `cacheUserPermissions(Long userId, Set<Permission>)` â†’ void

- [ ] **êµ¬í˜„ ë¡œì§**:
  ```java
  @Service
  public class PermissionResolverService {
      private final LoadUserRolesPort loadUserRolesPort;
      private final LoadRolePermissionsPort loadRolePermissionsPort;
      private final PermissionCache permissionCache;

      public boolean hasPermission(Long userId, ResourceType resource, ActionType action) {
          // 1. ìºì‹œ í™•ì¸
          Set<Permission> cachedPermissions = permissionCache.get(userId);
          if (cachedPermissions != null) {
              return cachedPermissions.stream()
                  .anyMatch(p -> p.getResource() == resource && p.getAction() == action);
          }

          // 2. DB ì¡°íšŒ (Query Model)
          Set<Long> roleIds = loadUserRolesPort.loadRoleIds(userId);
          Set<Permission> permissions = loadRolePermissionsPort.loadPermissionsByRoleIds(roleIds);

          // 3. ìºì‹± (15ë¶„ TTL)
          permissionCache.put(userId, permissions, Duration.ofMinutes(15));

          return permissions.stream()
              .anyMatch(p -> p.getResource() == resource && p.getAction() == action);
      }

      public Set<Permission> getUserPermissions(Long userId) {
          Set<Permission> cached = permissionCache.get(userId);
          if (cached != null) return cached;

          Set<Long> roleIds = loadUserRolesPort.loadRoleIds(userId);
          Set<Permission> permissions = loadRolePermissionsPort.loadPermissionsByRoleIds(roleIds);
          permissionCache.put(userId, permissions, Duration.ofMinutes(15));

          return permissions;
      }
  }
  ```

- [ ] **PermissionCache ì¸í„°í˜ì´ìŠ¤** (Out Port):
  - `get(Long userId)` â†’ Set<Permission>
  - `put(Long userId, Set<Permission>, Duration ttl)` â†’ void
  - `evict(Long userId)` â†’ void

- [ ] **Redis êµ¬í˜„**:
  - Key: `permission:user:{userId}`
  - TTL: 15ë¶„
  - Role ë³€ê²½ ì‹œ ìë™ evict

#### 2.1 AssignRoleToUserUseCase (Command)
- [ ] **Input**: AssignRoleToUserCommand
  - userId (Long, ëŒ€ìƒ ì‚¬ìš©ì)
  - roleId (Long)
  - requestedBy (Long, í˜„ì¬ ì‚¬ìš©ì)

- [ ] **Output**: UserRoleResponse
  - userId, roleId, assignedAt, assignedBy

- [ ] **Transaction**: í•„ìˆ˜

- [ ] **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:
  1. ê¶Œí•œ ê²€ì¦ (requestedByê°€ SUPER_ADMIN ë˜ëŠ” ORG_ADMINì¸ì§€)
  2. User ì¡°íšŒ (LoadUserPort)
  3. Role ì¡°íšŒ (LoadRolePort)
  4. ì´ë¯¸ Roleì„ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸
  5. User.assignRole(role)
  6. User ì €ì¥ (SaveUserPort)
  7. RoleAssignedToUser Event ë°œí–‰

#### 2.2 RemoveRoleFromUserUseCase (Command)
- [ ] **Input**: RemoveRoleFromUserCommand
  - userId (Long)
  - roleId (Long)
  - requestedBy (Long)

- [ ] **Output**: void

- [ ] **Transaction**: í•„ìˆ˜

- [ ] **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:
  1. ê¶Œí•œ ê²€ì¦ (requestedByê°€ SUPER_ADMIN ë˜ëŠ” ORG_ADMINì¸ì§€)
  2. User ì¡°íšŒ (LoadUserPort)
  3. User.removeRole(roleId)
  4. User ì €ì¥ (SaveUserPort)
  5. RoleRemovedFromUser Event ë°œí–‰

#### 2.3 AssignPermissionToRoleUseCase (Command)
- [ ] **Input**: AssignPermissionToRoleCommand
  - roleId (Long)
  - permissionId (Long)
  - requestedBy (Long, SUPER_ADMIN userId)

- [ ] **Output**: RolePermissionResponse

- [ ] **Transaction**: í•„ìˆ˜

- [ ] **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:
  1. SUPER_ADMIN ê¶Œí•œ ê²€ì¦
  2. Role ì¡°íšŒ (LoadRolePort)
  3. Permission ì¡°íšŒ (LoadPermissionPort)
  4. Role.addPermission(permissionId)
  5. Role ì €ì¥ (SaveRolePort)
  6. PermissionAssignedToRole Event ë°œí–‰

#### 2.4 GetUserRolesQuery (Query)
- [ ] **Input**: GetUserRolesQueryRequest
  - userId (Long)

- [ ] **Output**: List<RoleResponse>

- [ ] **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:
  1. User ì¡°íšŒ (LoadUserPort)
  2. Userì˜ Role ëª©ë¡ ë°˜í™˜

#### 2.5 GetUserPermissionsQuery (Query)
- [ ] **Input**: GetUserPermissionsQueryRequest
  - userId (Long)

- [ ] **Output**: List<PermissionResponse>

- [ ] **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:
  1. User ì¡°íšŒ (LoadUserPort)
  2. Userì˜ ëª¨ë“  Role ì¡°íšŒ
  3. ê° Roleì˜ Permission ì¡°íšŒ
  4. Permission ì¤‘ë³µ ì œê±° í›„ ë°˜í™˜

#### 2.6 CheckUserPermissionQuery (Query)
- [ ] **Input**: CheckUserPermissionQueryRequest
  - userId (Long)
  - resource (ResourceType)
  - action (ActionType)

- [ ] **Output**: boolean (hasPermission)

- [ ] **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**:
  1. **PermissionResolverService.hasPermission(userId, resource, action)** í˜¸ì¶œ
  2. ìºì‹œ íˆíŠ¸ ì‹œ ì¦‰ì‹œ ë°˜í™˜
  3. ìºì‹œ ë¯¸ìŠ¤ ì‹œ DB ì¡°íšŒ í›„ ìºì‹±

**ì¤‘ìš”**: User Domainì„ ì¡°íšŒí•˜ì§€ ì•Šê³ , PermissionResolverServiceë§Œ ì‚¬ìš©

#### 2.7 Port ì •ì˜

**Command Ports**:
- [ ] **SaveUserRolePort** (Out):
  - save(UserRole) â†’ UserRole

- [ ] **DeleteUserRolePort** (Out):
  - delete(Long userId, Long roleId) â†’ void

- [ ] **SaveRolePermissionPort** (Out):
  - save(RolePermission) â†’ RolePermission

**Query Ports (CQRS ë¶„ë¦¬)**:
- [ ] **LoadUserRolesPort** (Out):
  - `loadByUserId(Long userId)` â†’ List<UserRole>
  - `loadRoleIds(Long userId)` â†’ Set<Long> (ê²½ëŸ‰ ì¡°íšŒ, Permission ê²€ì¦ìš©)

- [ ] **LoadRolePermissionsPort** (Out):
  - `loadByRoleId(Long roleId)` â†’ List<RolePermission>
  - `loadPermissionsByRoleIds(Set<Long> roleIds)` â†’ Set<Permission> (Bulk ì¡°íšŒ, JOIN ìµœì í™”)

**Cache Port**:
- [ ] **PermissionCachePort** (Out):
  - `get(Long userId)` â†’ Set<Permission>
  - `put(Long userId, Set<Permission>, Duration ttl)` â†’ void
  - `evict(Long userId)` â†’ void
  - `evictAll()` â†’ void

### 3. Persistence Layer

#### 3.1 UserRoleEntity
- [ ] **UserRoleEntity** ìƒì„±
  - id (Long, PK)
  - user_id (Long, FK)
  - role_id (Long, FK)
  - assigned_at (LocalDateTime)
  - assigned_by (Long, FK)

#### 3.2 RolePermissionEntity
- [ ] **RolePermissionEntity** ìƒì„±
  - id (Long, PK)
  - role_id (Long, FK)
  - permission_id (Long, FK)
  - assigned_at (LocalDateTime)

#### 3.3 Flyway ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] **V13__create_user_roles.sql**:
  - user_roles í…Œì´ë¸” ìƒì„±
  - Unique Constraint: (user_id, role_id)
  - Index: (user_id), (role_id)

- [ ] **V14__create_role_permissions.sql**:
  - role_permissions í…Œì´ë¸” ìƒì„±
  - Unique Constraint: (role_id, permission_id)
  - Index: (role_id), (permission_id)

- [ ] **V15__assign_default_role_permissions.sql**:
  - SUPER_ADMIN â†’ ëª¨ë“  Permission
  - ORG_ADMIN â†’ ORGANIZATION:MANAGE, USER:READ, USER:MANAGE
  - MEMBER â†’ USER:READ

#### 3.4 Repository

**Command Repository (JPA)**:
- [ ] **UserRoleJpaRepository**:
  - save(UserRoleEntity) â†’ UserRoleEntity
  - deleteByUserIdAndRoleId(Long, Long) â†’ void

- [ ] **RolePermissionJpaRepository**:
  - save(RolePermissionEntity) â†’ RolePermissionEntity

**Query Repository (QueryDSL)**:
- [ ] **UserRoleQueryRepository**:
  - `findByUserId(Long userId)` â†’ List<UserRoleEntity>
  - `findRoleIdsByUserId(Long userId)` â†’ Set<Long> (ê²½ëŸ‰ ì¡°íšŒ)
  ```java
  public Set<Long> findRoleIdsByUserId(Long userId) {
      return queryFactory
          .select(userRole.roleId)
          .from(userRole)
          .where(userRole.userId.eq(userId))
          .fetch()
          .stream()
          .collect(Collectors.toSet());
  }
  ```

- [ ] **RolePermissionQueryRepository**:
  - `findByRoleId(Long roleId)` â†’ List<RolePermissionEntity>
  - `findPermissionsByRoleIds(Set<Long> roleIds)` â†’ Set<Permission> (Bulk JOIN)
  ```java
  public Set<Permission> findPermissionsByRoleIds(Set<Long> roleIds) {
      return queryFactory
          .select(Projections.constructor(Permission.class,
              permission.id,
              permission.resource,
              permission.action
          ))
          .from(rolePermission)
          .join(permission).on(rolePermission.permissionId.eq(permission.id))
          .where(rolePermission.roleId.in(roleIds))
          .fetch()
          .stream()
          .collect(Collectors.toSet());
  }
  ```

#### 3.5 Adapter

**Persistence Adapters**:
- [ ] **UserRolePersistenceAdapter** (SaveUserRolePort, DeleteUserRolePort, LoadUserRolesPort êµ¬í˜„)
  - Command: JpaRepository ì‚¬ìš©
  - Query: QueryDSL Repository ì‚¬ìš©

- [ ] **RolePermissionPersistenceAdapter** (SaveRolePermissionPort, LoadRolePermissionsPort êµ¬í˜„)
  - Bulk JOIN ì¿¼ë¦¬ë¡œ N+1 ë°©ì§€

**Cache Adapter**:
- [ ] **PermissionRedisCacheAdapter** (PermissionCachePort êµ¬í˜„)
  - Key Pattern: `permission:user:{userId}`
  - Value: Set<Permission> (JSON Serialization)
  - TTL: 15ë¶„
  - Eviction: Role ë³€ê²½ ì‹œ ìë™ evict
  ```java
  @Component
  public class PermissionRedisCacheAdapter implements PermissionCachePort {
      private final RedisTemplate<String, String> redisTemplate;
      private final ObjectMapper objectMapper;

      @Override
      public Set<Permission> get(Long userId) {
          String key = "permission:user:" + userId;
          String json = redisTemplate.opsForValue().get(key);
          if (json == null) return null;

          return objectMapper.readValue(json, new TypeReference<Set<Permission>>() {});
      }

      @Override
      public void put(Long userId, Set<Permission> permissions, Duration ttl) {
          String key = "permission:user:" + userId;
          String json = objectMapper.writeValueAsString(permissions);
          redisTemplate.opsForValue().set(key, json, ttl);
      }

      @Override
      public void evict(Long userId) {
          String key = "permission:user:" + userId;
          redisTemplate.delete(key);
      }
  }
  ```

#### 3.6 Mapper
- [ ] **UserRoleMapper**:
  - toEntity(UserRole) â†’ UserRoleEntity
  - toDomain(UserRoleEntity) â†’ UserRole

- [ ] **RolePermissionMapper**:
  - toEntity(RolePermission) â†’ RolePermissionEntity
  - toDomain(RolePermissionEntity) â†’ RolePermission

### 4. REST API Layer

#### 4.1 Endpoint
- [ ] **POST /api/v1/users/{userId}/roles**
  - HTTP Method: POST
  - Content-Type: application/json
  - Response: HTTP 201 Created
  - ì¸ì¦ í•„ìˆ˜ (SUPER_ADMIN, ORG_ADMIN)

- [ ] **DELETE /api/v1/users/{userId}/roles/{roleId}**
  - HTTP Method: DELETE
  - Response: HTTP 204 No Content
  - ì¸ì¦ í•„ìˆ˜ (SUPER_ADMIN, ORG_ADMIN)

- [ ] **GET /api/v1/users/{userId}/roles**
  - HTTP Method: GET
  - Response: HTTP 200 OK

- [ ] **GET /api/v1/users/{userId}/permissions**
  - HTTP Method: GET
  - Response: HTTP 200 OK

- [ ] **GET /api/v1/users/{userId}/permissions/check**
  - HTTP Method: GET
  - Query Params: resource, action
  - Response: HTTP 200 OK (boolean)

- [ ] **POST /api/v1/roles/{roleId}/permissions**
  - HTTP Method: POST
  - Content-Type: application/json
  - Response: HTTP 201 Created
  - ì¸ì¦ í•„ìˆ˜ (SUPER_ADMIN)

#### 4.2 Request DTO
- [ ] **AssignRoleToUserRequest**:
  - roleId (Long, @NotNull)

- [ ] **AssignPermissionToRoleRequest**:
  - permissionId (Long, @NotNull)

#### 4.3 Response DTO
- [ ] **UserRoleResponse**:
  - userId (Long)
  - roleId (Long)
  - assignedAt (LocalDateTime)
  - assignedBy (Long)

- [ ] **RolePermissionResponse**:
  - roleId (Long)
  - permissionId (Long)
  - assignedAt (LocalDateTime)

#### 4.4 Controller
- [ ] **UserController**:
  - assignRoleToUser(@PathVariable Long userId, @Valid AssignRoleToUserRequest, @AuthenticationPrincipal currentUserId) â†’ ResponseEntity<UserRoleResponse>
  - removeRoleFromUser(@PathVariable Long userId, @PathVariable Long roleId, @AuthenticationPrincipal currentUserId) â†’ ResponseEntity<Void>
  - getUserRoles(@PathVariable Long userId) â†’ ResponseEntity<List<RoleResponse>>
  - getUserPermissions(@PathVariable Long userId) â†’ ResponseEntity<List<PermissionResponse>>
  - checkUserPermission(@PathVariable Long userId, @RequestParam resource, action) â†’ ResponseEntity<Boolean>

- [ ] **RoleController**:
  - assignPermissionToRole(@PathVariable Long roleId, @Valid AssignPermissionToRoleRequest, @AuthenticationPrincipal userId) â†’ ResponseEntity<RolePermissionResponse>

#### 4.5 Error Handling
- [ ] **UserAlreadyHasRoleException** â†’ HTTP 409, "ì‚¬ìš©ìê°€ ì´ë¯¸ í•´ë‹¹ Roleì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤"
- [ ] **UserDoesNotHaveRoleException** â†’ HTTP 400, "ì‚¬ìš©ìê°€ í•´ë‹¹ Roleì„ ê°€ì§€ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤"
- [ ] **InsufficientPermissionException** â†’ HTTP 403, "ê¶Œí•œì´ ë¶€ì¡±í•©ë‹ˆë‹¤"

### 5. Integration Test

#### 5.1 E2E ì‹œë‚˜ë¦¬ì˜¤
- [ ] **ì •ìƒ Role í• ë‹¹**:
  - Given: SUPER_ADMIN ë¡œê·¸ì¸
  - When: POST /api/v1/users/{userId}/roles (roleId: ORG_ADMIN)
  - Then: HTTP 201, UserRoleResponse ë°˜í™˜
  - DB í™•ì¸: user_roles í…Œì´ë¸”ì— ë°ì´í„° ì‚½ì…
  - Event í™•ì¸: RoleAssignedToUser ë°œí–‰

- [ ] **ì´ë¯¸ ë³´ìœ í•œ Role í• ë‹¹ ì‹œë„**:
  - Given: ì´ë¯¸ ORG_ADMIN Role ë³´ìœ 
  - When: POST /api/v1/users/{userId}/roles (ê°™ì€ roleId)
  - Then: HTTP 409, "ì‚¬ìš©ìê°€ ì´ë¯¸ í•´ë‹¹ Roleì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤"

- [ ] **ì •ìƒ Role ì œê±°**:
  - Given: ORG_ADMIN Role ë³´ìœ 
  - When: DELETE /api/v1/users/{userId}/roles/{roleId}
  - Then: HTTP 204
  - DB í™•ì¸: user_roles í…Œì´ë¸”ì—ì„œ ì‚­ì œ
  - Event í™•ì¸: RoleRemovedFromUser ë°œí–‰

- [ ] **User Permission ì¡°íšŒ**:
  - Given: ORG_ADMIN Role ë³´ìœ  (ORG_ADMIN â†’ ORGANIZATION:MANAGE, USER:READ, USER:MANAGE)
  - When: GET /api/v1/users/{userId}/permissions
  - Then: HTTP 200, 3ê°œ Permission ë°˜í™˜

- [ ] **ê¶Œí•œ ê²€ì¦ (hasPermission)**:
  - Given: ORG_ADMIN Role ë³´ìœ 
  - When: GET /api/v1/users/{userId}/permissions/check?resource=ORGANIZATION&action=MANAGE
  - Then: HTTP 200, true ë°˜í™˜

- [ ] **Roleì— Permission í• ë‹¹**:
  - Given: SUPER_ADMIN ë¡œê·¸ì¸
  - When: POST /api/v1/roles/{roleId}/permissions (permissionId: USER:CREATE)
  - Then: HTTP 201, RolePermissionResponse ë°˜í™˜
  - DB í™•ì¸: role_permissions í…Œì´ë¸”ì— ë°ì´í„° ì‚½ì…

#### 5.2 í…ŒìŠ¤íŠ¸ ë°ì´í„°
- [ ] **@Sql**: V1~V15 ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] **SUPER_ADMIN ì‚¬ìš©ì**: INTERNAL ì‚¬ìš©ì + SUPER_ADMIN ê¶Œí•œ

---

## âš ï¸ ì œì•½ì‚¬í•­

### Zero-Tolerance ê·œì¹™
- [ ] **Long FK ì „ëµ** - UserRoleEntity, RolePermissionEntityì— `private Long userId`, `private Long roleId`
- [ ] **Tell Don't Ask** - User.assignRole, removeRole, hasPermission ë©”ì„œë“œ ì‚¬ìš©

### ì˜ì¡´ì„±
- **í•„ìˆ˜**:
  - AUT-000 (User Aggregate)
  - AUT-009 (Role ì‹œìŠ¤í…œ)
  - AUT-010 (Permission ê´€ë¦¬)

### ë³´ì•ˆ ê·œì¹™
- [ ] **SUPER_ADMIN, ORG_ADMIN ê¶Œí•œ ê²€ì¦** - Role í• ë‹¹/ì œê±°ëŠ” SUPER_ADMIN, ORG_ADMINë§Œ ê°€ëŠ¥
- [ ] **Permission í• ë‹¹ì€ SUPER_ADMIN ì „ìš©**

### í…ŒìŠ¤íŠ¸ ê·œì¹™
- [ ] **ArchUnit í…ŒìŠ¤íŠ¸** í•„ìˆ˜
- [ ] **Domain í…ŒìŠ¤íŠ¸**: User.assignRole, removeRole, hasPermission
- [ ] **UseCase í…ŒìŠ¤íŠ¸**: Mock ê¸°ë°˜
- [ ] **Integration í…ŒìŠ¤íŠ¸**: TestRestTemplate
- [ ] **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€** > 80%

---

## âœ… ì™„ë£Œ ì¡°ê±´

- [ ] Domain Layer êµ¬í˜„ ì™„ë£Œ (User í™•ì¥, UserRole VO, Role í™•ì¥, RolePermission VO)
- [ ] Application Layer êµ¬í˜„ ì™„ë£Œ (AssignRoleToUserUseCase, RemoveRoleFromUserUseCase, AssignPermissionToRoleUseCase, Query)
- [ ] Persistence Layer êµ¬í˜„ ì™„ë£Œ (UserRoleEntity, RolePermissionEntity, Repository, ê¸°ë³¸ ë°ì´í„° í• ë‹¹)
- [ ] REST API Layer êµ¬í˜„ ì™„ë£Œ (UserController, RoleController)
- [ ] Integration Test í†µê³¼ (E2E ì‹œë‚˜ë¦¬ì˜¤ 6ê°œ)
- [ ] ArchUnit í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] **ê¶Œí•œ ê²€ì¦ ë¡œì§ ì™„ë£Œ (hasPermission)**
- [ ] ì½”ë“œ ë¦¬ë·° ìŠ¹ì¸
- [ ] PR ë¨¸ì§€ ì™„ë£Œ

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- **PRD**: docs/prd/iam-platform.md (3.5 User-Role Assignment)
- **Plan**: docs/prd/plans/AUT-011-user-role-assignment-plan.md (create-plan í›„ ìƒì„±)
- **Jira**: https://ryuqqq.atlassian.net/browse/AUT-66
