# ===============================================
# Spring Boot Web API Application Configuration
# ===============================================
# Spring Boot 3.5.x + Java 21 기준
# Bootstrap 모듈 - 실행 가능한 애플리케이션 설정
#
# 설정 분리 원칙:
# - application.yml: 공통 인프라 설정 (Server, Jackson, Actuator)
# - application-{profile}.yml: 환경별 오버라이드
# - rest-api.yml: REST API 레이어 설정 (Security, OpenAPI)
# - persistence.yml: 영속성 레이어 설정 (DataSource, JPA, Flyway)
# - redis.yml: Redis/Redisson 설정
#
# @since 1.0.0
# ===============================================

# ===============================================
# Server Configuration (Tomcat)
# ===============================================
server:
  port: 8080

  # Proxy 헤더 처리 (ngrok, 로드밸런서 등)
  forward-headers-strategy: framework

  # Tomcat 서블릿 컨테이너 설정
  tomcat:
    # 스레드풀 설정
    threads:
      min-spare: 10
      max: 200

    # 커넥션 설정
    connection-timeout: 20s
    keep-alive-timeout: 60s

    # 큐 설정
    accept-count: 100

    # 최대 커넥션 수
    max-connections: 8192

  # Graceful Shutdown
  shutdown: graceful

# ===============================================
# Spring Configuration
# ===============================================
spring:
  application:
    name: authhub-api

  # Profile 설정
  profiles:
    active: local  # local, stage, prod

  # ===============================================
  # Config Import (각 모듈의 설정 파일 로드)
  # ===============================================
  config:
    import:
      - classpath:rest-api.yml
      - classpath:persistence.yml
      - classpath:redis.yml
      - classpath:security-client.yml

  # ===============================================
  # MessageSource (i18n)
  # ===============================================
  messages:
    basename: messages
    encoding: UTF-8
    fallback-to-system-locale: false

  # ===============================================
  # Jackson (JSON 직렬화/역직렬화)
  # ===============================================
  jackson:
    date-format: yyyy-MM-dd'T'HH:mm:ss
    time-zone: Asia/Seoul

    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false
      FAIL_ON_EMPTY_BEANS: false

    deserialization:
      FAIL_ON_UNKNOWN_PROPERTIES: false

    default-property-inclusion: non_null

  # ===============================================
  # Web Configuration
  # ===============================================
  web:
    locale: ko_KR
    locale-resolver: fixed

  # ===============================================
  # MVC Configuration
  # ===============================================
  mvc:
    contentnegotiation:
      favor-parameter: false
      favor-path-extension: false

# ===============================================
# Management & Actuator (모니터링)
# ===============================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,loggers
      base-path: /actuator

  endpoint:
    health:
      show-details: when-authorized
    loggers:
      enabled: true

  metrics:
    export:
      prometheus:
        enabled: true

    tags:
      application: ${spring.application.name}
      environment: ${spring.profiles.active:local}

    distribution:
      percentiles-histogram:
        http.server.requests: true
      percentiles:
        http.server.requests: 0.5,0.95,0.99
      slo:
        http.server.requests: 100ms,500ms,1s,5s

  health:
    db:
      enabled: true
    diskspace:
      enabled: true
