# ===============================================
# REST API Adapter Configuration
# ===============================================
# REST API 어댑터 전용 설정
# 애플리케이션 런타임 설정은 bootstrap/bootstrap-web-api/application.yml 참조
#
# @author windsurf
# @since 1.0.0
# ===============================================

# ===============================================
# Security Configuration
# ===============================================
# Gateway 인증 및 Cookie 보안 설정
security:
  # ===============================================
  # Service Token Configuration (Internal API)
  # ===============================================
  # 서비스 간 통신 (Gateway → AuthHub) 인증용
  service-token:
    # 서비스 토큰 인증 활성화 여부 (프로덕션에서는 true 필수)
    enabled: ${SERVICE_TOKEN_ENABLED:false}
    # 서비스 토큰 시크릿 키 (Gateway와 공유)
    secret: ${SERVICE_TOKEN_SECRET:local-dev-service-token-secret}

  # ===============================================
  # JWT Configuration
  # ===============================================
  jwt:
    # JWT 서명 키 (HS256 사용 시 필요, 최소 256bit = 32바이트)
    secret: ${JWT_SECRET:local-dev-secret-key-minimum-32-bytes-long}
    # Access Token 만료 시간 (초) - 기본 1시간
    access-token-expiration: ${JWT_ACCESS_TOKEN_EXPIRATION:3600}
    # Refresh Token 만료 시간 (초) - 기본 7일
    refresh-token-expiration: ${JWT_REFRESH_TOKEN_EXPIRATION:604800}
    # 발급자
    issuer: ${JWT_ISSUER:authhub}
    # RSA 키 설정 (RS256 사용 시)
    rsa:
      # RS256 활성화 여부 (true: RS256, false: HS256)
      enabled: ${JWT_RSA_ENABLED:false}
      # JWKS에서 키 식별용 Key ID
      key-id: ${JWT_RSA_KEY_ID:authhub-key-1}
      # RSA 공개키 경로 (JWKS 제공용)
      public-key-path: ${JWT_RSA_PUBLIC_KEY_PATH:}
      # RSA 개인키 경로 (JWT 서명용)
      private-key-path: ${JWT_RSA_PRIVATE_KEY_PATH:}
  gateway:
    # Gateway 인증 활성화 여부 (환경별로 오버라이드)
    enabled: false
    # Gateway에서 전달하는 사용자 ID 헤더
    user-id-header: X-User-Id
    # Gateway에서 전달하는 사용자 역할 헤더
    user-roles-header: X-User-Roles
    # Gateway에서 전달하는 테넌트 ID 헤더
    tenant-id-header: X-Tenant-Id
  cookie:
    # Cookie secure 속성 (환경별로 오버라이드)
    secure: false
    # Cookie httpOnly 속성
    http-only: true
    # Cookie same-site 속성
    same-site: lax
    # Cookie domain (환경별로 오버라이드)
    domain: localhost
    # Cookie 경로
    path: /

# ===============================================
# API Endpoint Configuration
# ===============================================
# REST API 엔드포인트 경로 중앙 관리
# @see com.ryuqq.authhub.adapter.in.rest.auth.paths.ApiPaths (상수 클래스 사용)
api:
  # 에러 응답 설정 (RFC 7807 Problem Details)
  # @see com.ryuqq.adapter.in.rest.config.properties.ApiErrorProperties
  error:
    # 에러 타입 문서 베이스 URL
    # 프로덕션: https://api.example.com/problems
    # 개발: about:blank (기본값)
    base-url: about:blank

    # about:blank 사용 여부 (true: 문서 URL 무시, false: base-url 사용)
    use-about-blank: true


  # CORS 설정
  # 엔드포인트 권한은 SecurityPaths.java에서 관리 (Java 상수 방식)
  cors:
    allowed-origins:
      - http://localhost:3000
      - http://localhost:5173
      - http://localhost:5174
      - http://localhost:8080
    allowed-methods:
      - GET
      - POST
      - PUT
      - PATCH
      - DELETE
      - OPTIONS
    allowed-headers:
      - "*"
    exposed-headers:
      - Authorization
      - Set-Cookie
      - X-Request-Id
    allow-credentials: true

# ===============================================
# SpringDoc OpenAPI Configuration
# ===============================================
# Swagger UI: http://localhost:8080/api/v1/auth/swagger-ui.html
# API Docs: http://localhost:8080/api/v1/auth/api-docs
springdoc:
  api-docs:
    path: /api/v1/auth/api-docs
    enabled: true
  swagger-ui:
    path: /api/v1/auth/swagger-ui.html
    enabled: true
    # 태그/오퍼레이션 정렬
    tags-sorter: alpha
    operations-sorter: alpha
    # 기본 펼침 상태
    doc-expansion: list
    # 요청 시간 표시
    display-request-duration: true
    # 모델 펼침 깊이
    default-models-expand-depth: 2
    default-model-expand-depth: 2
    # 검색 필터 활성화
    filter: true
  # 기본 Content-Type
  default-consumes-media-type: application/json
  default-produces-media-type: application/json
  # 패키지 스캔 설정
  packages-to-scan: com.ryuqq.authhub.adapter.in.rest
  # 경로 매칭
  paths-to-match: /api/**